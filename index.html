<!DOCTYPE html>
<html lang="en" style="width: 100%; height: 100%;">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>web-paint</title>
</head>
<body style="width: 100%; height: 100%; margin: 0px;">
    <style>
        .tool_bar {
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            height: 20%;
            min-height: 100px;
            min-width: 600px;
        }

        .tool_quick_access {
            position: relative;
            top: 0;
            left: 0;

            height: 15%;
            width: 100%;

            background-color: aqua;
        }

        .tool_category_selector {
            position: relative;
            top: 0;
            left: 0;

            height: 20%;
            width: 100%;
        }

        .tool {
            background-color: #ffffff;

            width: 5%;
            height: 100%;

            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            font-size: 100%;

            float: left;
        }

        .tool_selected {
            background-color: #f5f6f7;

            width: 5%;
            height: 100%;

            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            font-size: 100%;

            float: left;

            border-color: #dadbdc;
            border-style: solid;
            border-top-width: 1px;
            border-bottom-width: 0px;
            border-left-width: 1px;
            border-right-width: 1px;
        }

        .tool_menu {
            background-color: #f5f6f7;

            width: 100%;
            height: 65%;

            border-color: #dadbdc;
            border-style: solid;
            border-top-width: 1px;
            border-bottom-width: 1px;
            border-left-width: 0px;
            border-right-width: 0px;
        }

        .palette_colours {
            /*
            float: left;
            
            aspect-ratio: 1 / 1;
            height: 75%;

            border: 2px #ffffff;
            border-style: solid;

            outline: 1px;
            outline-color: #a0a0a0;
            outline-style: solid;

            margin: 2px;
            */

            height: 100%;
            aspect-ratio: 1 / 1;
            background-color: red;
            float: left;
        }

        .fake_table_column {
            float: left;
            height: 100%;
        }

        .fake_table_column_seperators {
            /* use: "<div class="fake_table_column_seperators"></div>" */
            height: 100%;
            width: 2px;
            background-color: #dadbdc;
            float: left;
            margin-left: 5px;
            margin-right: 5px;
        }

        .fake_table_entry {
            height: 33.3%;
        }

    </style>

    <div id="tool_bar" class="tool_bar">
        <div id="tool_quick_access" class="tool_quick_access"><!-- gets filled by js --></div>

        <div id="tool_category_selector" class="tool_category_selector"><!-- gets filled by js --></div>

        <div id="place_for_tool_menu" class="tool_menu">
            <!-- ids: e.g. "tool_Export", "tool_Import" -->

            <div id="tool_Export" hidden>
                <label for="export_file_type">
                    Choose a file type for exporting:
                </label>
                <select name="export_file_type" id="export_file_type">
                    <option value="image/png">PNG (default)</option>
                    <option value="image/jpeg">JPEG</option>
                    <!-- <option value="image/apng">APNG</option> -->
                    <!-- <option value="image/avif">AVIF</option> -->
                    <!-- <option value="image/gif">GIF</option> -->
                    <!-- <option value="image/svg+xml">SVG</option> -->
                    <option value="image/webp">WebP</option>
                    <option value="image/bmp">BMP</option>
                    <!-- <option value="image/x-icon">ICO</option> -->
                    <!-- <option value="image/tiff">TIFF</option> -->
                </select>
                <br>
                define background 
                <input type="checkbox" id="export_define_background">
                <br>
                when exporting, all layers are combined
                <br>
            </div>

            <div id="tool_Import" hidden>

            </div>

            <div id="tool_Canvas" hidden style="height: 100%;">
                <!-- column for the checkboxes -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <input type="checkbox" id="show_grid" onclick="grid.toggle_grid()" checked="true">
                    </div>
                    <div class="fake_table_entry"></div>
                    <div class="fake_table_entry"></div>
                </div>
                <!-- column for the checkbox descriptions -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        show grid
                    </div>
                    <div class="fake_table_entry"></div>
                    <div class="fake_table_entry"></div>
                </div>

                <div class="fake_table_column_seperators"></div>

                <!-- column for grid thickness and pixels seperated descriptions  -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        grid thickness (in pixels):
                    </div>
                    <div class="fake_table_entry">
                        pixels seperated (width):
                    </div>
                    <div class="fake_table_entry">
                        pixels seperated (height):
                    </div>
                </div>
                <!-- number inputs for ^ -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <input type="number" value="1" id="grid_thickness">
                    </div>
                    <div class="fake_table_entry">
                        <input type="number" value="10" id="px_sep_w">
                    </div>
                    <div class="fake_table_entry">
                        <input type="number" value="10" id="px_sep_h">
                    </div>
                </div>
                <!-- apply buttons for ^ -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <button onclick="grid.apply_grid_thickness()">Apply</button>
                    </div>
                    <div class="fake_table_entry">
                        <button onclick="grid.redo_pixels_seperated_w()">Apply</button>
                    </div>
                    <div class="fake_table_entry">
                        <button onclick="grid.redo_pixels_seperated_h()">Apply</button>
                    </div>
                </div>

                <div class="fake_table_column_seperators"></div>

                <!-- description for canvas dimensions -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        width:
                    </div>
                    <div class="fake_table_entry">
                        height:
                    </div>
                    <div class="fake_table_entry">
                        zoom:
                    </div>
                </div>
                <!-- input for canvas dimensions -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <input type="number" id="canvas_w_input" value="50">
                    </div>
                    <div class="fake_table_entry">
                        <input type="number" id="canvas_h_input" value="50">
                    </div>
                    <div class="fake_table_entry">
                        <input type="number" value="10" id="canvas_zoom">
                    </div>
                </div>
                <!-- apply buttons for canvas dimensions -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <button onclick="canvas.change_width()">Apply</button>
                    </div>
                    <div class="fake_table_entry">
                        <button onclick="canvas.change_height()">Apply</button>
                    </div>
                    <div class="fake_table_entry">
                        <button onclick="canvas.change_zoom()">Apply</button>
                    </div>
                </div>
            </div>

            <div id="tool_Colour" hidden style="height: 100%; max-width:100%;">
                <!-- displaying the colour names -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        red:
                    </div>
                    <div class="fake_table_entry">
                        green:
                    </div>
                    <div class="fake_table_entry">
                        blue:
                    </div>
                </div>
                <!-- displaying the values from the colour sliders -->
                <div class="fake_table_column">
                    <div class="fake_table_entry" id="colour_red"></div>
                    <div class="fake_table_entry" id="colour_green"></div>
                    <div class="fake_table_entry" id="colour_blue"></div>
                </div>
                <!-- sliders to change the values -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <input type="range" min="0" max="255" value="0" onchange="colour_mixer.update()" id="input_red" oninput="colour_mixer.update()" onkeypress="colour_mixer.update()">
                    </div>
                    <div class="fake_table_entry">
                        <input type="range" min="0" max="255" value="0" onchange="colour_mixer.update()" id="input_green" oninput="colour_mixer.update()" onkeypress="colour_mixer.update()">
                    </div>
                    <div class="fake_table_entry">
                        <input type="range" min="0" max="255" value="0" onchange="colour_mixer.update()" id="input_blue" oninput="colour_mixer.update()" onkeypress="colour_mixer.update()">
                    </div>
                </div>
                <!-- additional information for the mixed colour -->
                <div class="fake_table_column">
                    <div class="fake_table_entry" id="colour_preview">
                        
                    </div>
                    <div class="fake_table_entry" id="rgb">

                    </div>
                    <div class="fake_table_entry" id="hex">

                    </div>
                </div>

                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        
                    </div>
                    <div class="fake_table_entry">

                    </div>
                    <div class="fake_table_entry">

                    </div>
                </div>

                <!-- palette -->
                <div class="fake_table_column">
                    <div class="fake_table_entry" id="palette_row_0"></div>
                    <div class="fake_table_entry" id="palette_row_1"></div>
                    <div class="fake_table_entry" id="palette_row_2"></div>
                </div>

                <!-- background colour -->
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        rgb
                    </div>
                    <div class="fake_table_entry">
                        hex
                    </div>
                </div>
                <div class="fake_table_column">
                    <div class="fake_table_entry" id="background_rgb_display"></div>
                    <div class="fake_table_entry" id="background_hex_display"></div>
                </div>
                <div class="fake_table_column">
                    <div class="fake_table_entry">
                        <button onclick="canvas.change_colour()">Use from colour mixer</button>
                    </div>
                </div>
            </div>

            <div id="tool_Layers" hidden style="height: 100%;">
                <button onclick="layers.create_layer()" style="float: left;">Create new Layer</button>
                <div style="overflow-y: scroll; height: 100%">
                    <div id="layers_table" style="height: 100%"></div>
                </div>
            </div>
        </div>
    </div>

    <div style="height: 0.5%; background-color: rgb(198, 207, 223);"></div>

    <div style="height: 75.5%; overflow-x: scroll; overflow-y: scroll; width: 100%;">
        <div id="canvas" style="height: 100%; width: 100%;">
            <div id="layer_imgs"></div>
    
            <div id="grid">
                <div id="inner_grid">
                    <div id="horizontal_grid"></div>
                    <div id="vertical_grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div style="background-color: #f5f6f7; height: 4%; float: bottom;"></div>

    <script type="text/javascript">
        /**
        white
        #ffffff

        Tiffany Blue
        #bcece0

        Cyan
        #36eee0

        Hot Pink
        #f652a0

        Cornflower
        #4c5270
        */
        
        class Canvas {
            constructor() {
                this.canvas                 = document.getElementById("canvas");
                this.background_rgb_display = document.getElementById("background_rgb_display");
                this.background_hex_display = document.getElementById("background_hex_display");
        
                this.width_input     = document.getElementById("canvas_w_input");
                this.height_input    = document.getElementById("canvas_h_input");
                this.zoom_input      = document.getElementById("canvas_zoom");
        
                this.width      = 50;
                this.height     = 50;
                this.bg_colour  = "#000000";
                this.zoom       = 10;
            }

            change_width() {
                this.width = Number(this.width_input.value);
                this.apply_changes();
                grid.redo_grid();
            }

            change_height() {
                this.height = Number(this.width_input.value);
                this.apply_changes();
                grid.redo_grid();
            }

            change_zoom() {
                this.zoom = Number(this.zoom_input.value);
                this.apply_changes();
                grid.redo_grid();
            }

            change_colour() {
                let r = colour_mixer.rgb_value.textContent;
                let h = colour_mixer.hex_value.textContent;
            
                this.bg_colour = h;
            
                this.background_rgb_display.textContent = r;
                this.background_hex_display.textContent = h;
            
                this.apply_changes();
            }
        
            apply_changes() {
                this.canvas.style = "background-color: " + this.bg_colour + "; height: " + this.height + "px; width: " + this.width + "px; transform: scale(" + this.zoom + "); transform-origin: 0% 0% 0px;";
            }
        }

        class ColourMixer{
            constructor() {
                this.rgb_display = [
                    document.getElementById("colour_red"),
                    document.getElementById("colour_green"),
                    document.getElementById("colour_blue")
                ];
                this.rgb_input = [
                    document.getElementById("input_red"),
                    document.getElementById("input_green"),
                    document.getElementById("input_blue")
                ];
                this.rgb_value      = document.getElementById("rgb");
                this.hex_value      = document.getElementById("hex");
                this.colour_preview = document.getElementById("colour_preview");
            }
        
            component_to_hex(c) {
                // https://www.w3docs.com/snippets/javascript/how-to-convert-rgb-to-hex-and-vice-versa.html
        
                let hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }
        
            update() {
                let r = this.rgb_input[0].value;
                let g = this.rgb_input[1].value;
                let b = this.rgb_input[2].value;
        
                this.rgb_display[0].textContent = r;
                this.rgb_display[1].textContent = g;
                this.rgb_display[2].textContent = b;
        
                this.rgb_value.textContent = "rgb(" + r + ", " + g + ", " + b + ")";
                this.hex_value.textContent = "#" + this.component_to_hex(Number(r)) + this.component_to_hex(Number(g)) + this.component_to_hex(Number(b));
                this.colour_preview.style = "background-color: " + this.hex_value.textContent + ";";
            }
        }

        class Grid {
            constructor() {
                this.grid               = document.getElementById("grid");
                this.outer_grid         = document.getElementById("outer_grid");
                this.inner_grid         = document.getElementById("inner_grid");
                this.horizontal_grid    = document.getElementById("horizontal_grid");
                this.vertical_grid      = document.getElementById("vertical_grid");
        
                this.show_grid              = document.getElementById("show_grid");
                this.show_inner_grid        = document.getElementById("show_inner_grid");
                this.show_outer_grid        = document.getElementById("show_outer_grid");
                this.grid_thickness_input   = document.getElementById("grid_thickness");
                this.px_sep_w               = document.getElementById("px_sep_w");
                this.px_sep_h               = document.getElementById("px_sep_h");
        
                this.grid_thickness      = Number(this.grid_thickness_input.value);
                this.horizontal_lines    = [];
                this.vertical_lines      = [];
                this.pixels_seperated_w  = Number(this.px_sep_w.value);
                this.pixels_seperated_h  = Number(this.px_sep_w.value);
            }
        
            toggle_grid() {
                this.grid.hidden = !this.show_grid.checked;
            }
        
            toggle_outer_grid() {
                return;
                this.outer_grid.hidden = !this.show_outer_grid.checked;
            }
            
            toggle_inner_grid() {
                return;
                this.inner_grid.hidden = !this.show_inner_grid.checked;
            }
        
            remove_horizontal_lines() {
                for (let i = 0; i < this.horizontal_lines.length; i++) {
                    this.horizontal_lines[i].remove();
                }
                this.horizontal_lines = [];
            }
            
            remove_vertical_lines() {
                for (let i = 0; i < this.vertical_lines.length; i++) {
                    this.vertical_lines[i].remove();
                }
                this.vertical_lines = [];
            }
        
            add_horizontal_lines() {
                for (let i = this.pixels_seperated_h * canvas.zoom; i < (canvas.height * canvas.zoom); i = i + this.pixels_seperated_h * canvas.zoom) {
                    let x = document.createElement("div");
                    x.style = "background-color: #000000; width: " + canvas.width * canvas.zoom + "px; height: " + this.grid_thickness + "px; position: absolute; top: " + i + "px;";
                    this.horizontal_grid.appendChild(x);
                    this.horizontal_lines.push(x);
                }
            }
            
            add_vertical_lines() {
                for (let i = this.pixels_seperated_w * canvas.zoom; i < (canvas.width * canvas.zoom); i = i + this.pixels_seperated_w * canvas.zoom) {
                    let x = document.createElement("div");
                    x.style = "background-color: #000000; height: " + canvas.height * canvas.zoom + "px; width: " + this.grid_thickness + "px; position: absolute; left: " + i + "px;";
                    this.vertical_grid.appendChild(x);
                    this.vertical_lines.push(x);
                }
            }
        
            apply_grid_thickness() {
                this.grid_thickness = Number(this.grid_thickness_input.value);
                this.redo_grid();
            }
            
            redo_pixels_seperated_w() {
                this.pixels_seperated_w = Number(this.px_sep_w.value);
                this.redo_grid();
            }
            
            redo_pixels_seperated_h() {
                this.pixels_seperated_h = Number(this.px_sep_h.value);
                this.redo_grid();
            }
            
            redo_grid() {
                this.remove_horizontal_lines();
                this.remove_vertical_lines();
                this.add_horizontal_lines();
                this.add_vertical_lines();
                this.grid.style = "transform: scale(" + 1 / canvas.zoom + "); transform-origin: 0% 0% 0px; height: 100%; width: 100%;";
            }
        }

        class Layer {
            constructor(id) {
                this.pixels = [];
                this.id = id;
                this.layer = document.createElement("div");
                let l = document.getElementById("layer_imgs");

                for (let i = 0; i < canvas.width; i++) {
                    let sublist = [];
                    for (let j = 0; j < canvas.height; j++) {
                        let x = document.createElement("div");
                        x.style = "height: 1px; width: 1px; position: absolute; top: " + i + "px; left: " + j+ "px;";
                        sublist.push(x);
                        this.layer.appendChild(x);
                    }
                    this.pixels.push(sublist);
                }

                l.appendChild(this.layer);
            }
        }

        class Layers {
            constructor() {
                this.layer_gui_table    = document.getElementById("layers_table");
                this.layer_imgs         = document.getElementById("layer_imgs");
        
                this.layer_count    = 0;
                this.layer_table    = [];
                this.layer_objects  = [];
                this.current_layer  = 0;
            }

            create_layer() {
                let l = new Layer(this.layer_count);
                this.layer_objects.push(l);
                let layer_gui = document.createElement("div");

                // layer name
                let layer_name = document.createElement("div");
                let name_input = document.createElement("input");
                name_input.value = "Layer: " + this.layer_count;
                layer_name.appendChild(name_input);
                layer_gui.appendChild(layer_name);
                layer_gui.style = "float: left;"

                // hide button
                let toggle_visability = document.createElement("div");
                let visability_text = document.createElement("div");
                visability_text.textContent = "visible: ";
                let visability_checkbox = document.createElement("input");
                visability_checkbox.type = "checkbox";
                visability_checkbox.checked = true;
                visability_checkbox.onclick = () => {
                    l.layer.hidden = !l.layer.hidden;
                };
                toggle_visability.appendChild(visability_text);
                toggle_visability.appendChild(visability_checkbox);
                layer_gui.appendChild(toggle_visability);

                // select button
                let select_button = document.createElement("button");
                select_button.textContent = "Select";
                select_button.onclick = () => {
                    this.layer_table[this.current_layer].style.backgroundColor = "";
                    this.current_layer = l.id;
                    layer_gui.style.backgroundColor = "#f652a0";
                };
                layer_gui.appendChild(select_button);

                // delete button
                let delete_button = document.createElement("button");
                delete_button.textContent = "Delete";
                delete_button.onclick = () => {
                    let x = this.layer_objects[l.id];
                    x.layer.remove()
                    this.layer_objects[l.id] = null;

                    x = this.layer_table[l.id];
                    x.remove();
                    this.layer_table[l.id] = null;

                    if (this.current_layer == l.id) {
                        for (let i = 0; i < this.layer_objects.length; i++) {
                            if (this.layer_objects[i] != null) {
                                this.current_layer = i;
                                this.layer_table[this.current_layer].style.backgroundColor = "#f652a0";
                                return;
                            }
                        }
                        this.current_layer = this.layer_count;
                        this.create_layer();
                    }
                };
                layer_gui.appendChild(delete_button);

                this.layer_table.push(layer_gui);
                this.layer_gui_table.appendChild(layer_gui);

                this.layer_table[this.current_layer].style.backgroundColor = "";
                layer_gui.style.backgroundColor = "#f652a0";
                
                this.current_layer = this.layer_count;
                this.layer_count++;
            }
        }

        class BackgroundColourHistory {
            constructor() {
                this.history_element = null;
            }
        }

        class ToolMenu {
            constructor() {
                this.QUICK_ACCESS_ELEMENT       = document.getElementById("tool_quick_access");
                this.CATEGORY_SELECTOR_ELEMENT  = document.getElementById("tool_category_selector");
                this.TOOL_MENU_ELEMENT          = document.getElementById("place_for_tool_menu");

                this.TOOL_IDS               = ["Import", "Export", "Canvas", "Colour", "Layers"];
                this.TOOL_BUTTONS_ELEMENTS  = [];
                this.TOOL_ELEMENTS          = [];

                this._setup_tools();

                this.current_tool = 0;

                this.TOOL_BUTTONS_ELEMENTS[0].click();
            }

            _setup_tools() {
                for (let i = 0; i < this.TOOL_IDS.length; i++) {
                    // get tool name
                    let id = this.TOOL_IDS[i];

                    // get tool element
                    let tool_element = document.getElementById("tool_" + id);
                    this.TOOL_ELEMENTS.push(tool_element);

                    // create button
                    let btn = document.createElement("div");
                    btn.textContent = id;
                    btn.className = "tool";
                    btn.onclick = () => {
                        // change previous apperance
                        this.TOOL_BUTTONS_ELEMENTS[this.current_tool].className = "tool";
                        this.TOOL_ELEMENTS[this.current_tool].hidden = true;

                        // change own apperance
                        btn.className = "tool_selected";
                        tool_element.hidden = false;

                        // change current tool
                        this.current_tool = i;
                    };
                    this.CATEGORY_SELECTOR_ELEMENT.appendChild(btn);
                    this.TOOL_BUTTONS_ELEMENTS.push(btn);
                }
            }
        }

        class Palette {
            constructor() {
                this.ROW_ELEMENTS = [];
                this.AMOUNT_ROWS  = 3;
                this.AMOUNT_COLUMNS = 20;

                for (let i = 0; i < this.AMOUNT_ROWS; i++) {
                    this.ROW_ELEMENTS.push(document.getElementById("palette_row_" + i));
                    for (let j = 0; j < this.AMOUNT_COLUMNS; j++) {
                        let a = document.createElement("div");
                        a.className = "palette_colours";

                        this.ROW_ELEMENTS[i].appendChild(a);
                    }
                }
            }
        }
        
        class Export {
            constructor() {
                this.EXPORT_ELEMENT = document.getElementById("tool_Export");
                let btn = document.createElement("button");
                btn.textContent = "EXPORT";
                btn.onclick = this.do_export;
                this.EXPORT_ELEMENT.appendChild(btn);
            }

            do_export() {
                let c = document.createElement("canvas");
                let ctx = c.getContext("2d");

                c.width = canvas.width;
                c.height = canvas.height;

                if (document.getElementById("export_define_background").checked) {
                    ctx.fillStyle = canvas.bg_colour;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                for (let i = 0; i < layers.layer_objects.length; i++) {
                    let l = layers.layer_objects[i];

                    for (let x = 0; x < l.pixels.length; x++) {
                        for (let y = 0; y < l.pixels[x].length; y++) {
                            let bg = l.pixels[y][x].style.backgroundColor;
                            if (bg != "") {
                                ctx.fillStyle = bg;
                                ctx.fillRect(x, y, 1, 1);
                            }
                        }
                    }
                }

                let file_type = document.getElementById("export_file_type").value;
                console.log(file_type);
                let imageData = c.toDataURL(file_type);
                var tmpLink = document.createElement( 'a' );  
                tmpLink.download = 'image'; 
                tmpLink.href = imageData;
                tmpLink.hidden = true;
                
                // temporarily add link to body and initiate the download  
                document.body.appendChild(tmpLink);  
                tmpLink.click();  
                document.body.removeChild(tmpLink);
            }
        }

        class Export2 {
            constructor() {
                this.EXPORT_ELEMENT = document.getElementById("tool_Export");
                let btn = document.createElement("button");
                btn.textContent = "EXPORT TO LOCALSTORADGE";
                btn.onclick = this.do_export;
                this.EXPORT_ELEMENT.appendChild(btn);
            }

            do_export() {
                let total = "";
                for (let i = 0; i < layers.layer_objects.length; i++) {
                    let l = layers.layer_objects[i];

                    for (let x = 0; x < l.pixels.length; x++) {
                        for (let y = 0; y < l.pixels[x].length; y++) {
                            let bg = l.pixels[y][x].style.backgroundColor;
                            if (bg != "") {
                                ctx.fillStyle = bg;
                                ctx.fillRect(x, y, 1, 1);
                            }
                        }
                    }
                }
            }
        }

        const canvas        = new Canvas();
        const colour_mixer  = new ColourMixer();
        const grid          = new Grid();
        const layers        = new Layers();
        const tool_menu     = new ToolMenu();
        const palette       = new Palette();
        const export_img    = new Export();
        const export_b64    = new Export2();

        //
        // drawing
        // 

        function draw(canvas, event) {
            const rect = canvas.canvas.getBoundingClientRect();
            let x = (event.clientX - rect.left) / canvas.zoom;
            x = Math.floor(x);
            let y = (event.clientY - rect.top) / canvas.zoom;
            y = Math.floor(y);
            console.log("x: " + x + " y: " + y);

            let layer = layers.layer_objects[layers.current_layer];
            if (!layer.layer.hidden) {
                let pixel = layer.pixels[y][x].style.backgroundColor = colour_mixer.hex_value.textContent;
            }
        }

        //
        // - setup
        //

        function setup() {
            // colour mixer
            colour_mixer.update();

            // canvas
            canvas.change_width();
            canvas.change_height();
            canvas.change_zoom();
            canvas.change_colour();
            canvas.apply_changes();
            canvas.canvas.addEventListener('mousedown', function(e) {
                draw(canvas, e);
            });

            // grid
            grid.toggle_grid();
            grid.toggle_inner_grid();
            grid.toggle_outer_grid();
            grid.redo_grid();

            // layers
            layers.create_layer();
        }
        
        setup();
    </script>
</body>
</html>